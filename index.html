<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ í¬ì™• ì¹´ë“œê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            overflow-x: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            padding: 20px;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard {
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .dashboard h1 {
            font-size: 3em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.2em;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s;
            min-width: 200px;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }

        .btn.bonus {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .game-info {
            display: flex;
            gap: 30px;
            font-size: 1.1em;
        }

        /* ì¹´ë“œ ë½‘ê¸° í™”ë©´ */
        .pack-opening {
            text-align: center;
            justify-content: center;
        }

        .pack-opening h2 {
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .pack-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin: 30px auto;
            max-width: 800px;
        }

        .pack {
            width: 120px;
            height: 180px;
            background: linear-gradient(45deg, #8e44ad, #3498db);
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: transform 0.3s;
            margin: 0 auto;
        }

        .pack:hover {
            transform: scale(1.1);
        }

        .pack.opened {
            background: #34495e;
            cursor: not-allowed;
        }

        /* ë³´ë„ˆìŠ¤ íŒ© í™”ë©´ */
        .bonus-pack {
            text-align: center;
            justify-content: center;
            align-items: center;
        }

        .bonus-pack h2 {
            color: #f39c12;
            font-size: 2.5em;
            margin-bottom: 30px;
        }

        .single-pack {
            width: 200px;
            height: 300px;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5em;
            transition: transform 0.3s;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .single-pack:hover {
            transform: scale(1.1);
        }

        /* ìŠ¤í…Œì´ì§€ ì„ íƒ */
        .stage-select {
            text-align: center;
            justify-content: center;
        }

        .stage-select h2 {
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .stage-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            max-width: 800px;
            margin: 30px auto;
        }

        .stage-btn {
            padding: 20px;
            background: linear-gradient(45deg, #16a085, #27ae60);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .stage-btn:hover {
            transform: scale(1.05);
        }

        .stage-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        /* ë°°í‹€ í™”ë©´ */
        .battle {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 10px;
        }

        .battle-info {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .phase-indicator {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 10px;
        }

        /* ìœ í¬ì™• í…Œì´ë¸” */
        .duel-table {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            border: 3px solid #1e8449;
            flex: 1;
        }

        .field-side {
            margin: 20px 0;
        }

        .field-label {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .field-zones {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .zone {
            width: 80px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            text-align: center;
        }

        .zone:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .zone.monster-zone {
            border-color: #e74c3c;
        }

        .zone.spell-trap-zone {
            border-color: #3498db;
        }

        .zone.selected {
            border-color: #f1c40f;
            background: rgba(241, 196, 15, 0.3);
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.7);
        }

        .zone.occupied {
            background: rgba(46, 204, 113, 0.3);
        }

        .card {
            width: 78px;
            height: 118px;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            border-radius: 8px;
            border: 2px solid #d35400;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            text-align: center;
            padding: 3px;
            transition: transform 0.3s;
            position: relative;
            user-select: none;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card.monster {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .card.magic {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .card.trap {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .card.selected {
            border: 3px solid #f1c40f;
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.7);
        }

        .hand {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px;
            min-height: 140px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin: 10px 0;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
        }

        .battle-log {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            height: 80px;
            overflow-y: auto;
            font-size: 0.9em;
        }

        /* ì¹´ë“œ ê³µê°œ ì˜¤ë²„ë ˆì´ */
        .card-reveal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .card-reveal-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 80%;
        }

        .card-reveal {
            width: 150px;
            height: 220px;
            position: relative;
            cursor: pointer;
            perspective: 1000px;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .card-reveal.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
        }

        .card-back {
            background: linear-gradient(45deg, #8e44ad, #3498db);
            color: white;
            font-weight: bold;
        }

        .card-front {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            transform: rotateY(180deg);
            color: white;
        }

        .card-front.monster {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .card-front.magic {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .card-front.trap {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .card-illustration {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            z-index: 1001;
        }

        /* ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ */
        .card-select-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .card-select-container {
            background: rgba(52, 73, 94, 0.9);
            border-radius: 15px;
            padding: 20px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ëŒ€ì‹œë³´ë“œ í™”ë©´ (ê¸°ë³¸ í™”ë©´) -->
        <div class="screen dashboard active" id="dashboard">
            <h1>ìœ í¬ì™• ë“€ì–¼ ëª¬ìŠ¤í„°ì¦ˆ</h1>
            <div class="menu-buttons">
                <button class="btn" onclick="showScreen('pack-opening')">ê¸°ë³¸ ì¹´ë“œ ë½‘ê¸°</button>
                <button class="btn bonus" onclick="showScreen('bonus-pack')" id="bonusPackBtn" style="display:none;">ë³´ë„ˆìŠ¤ íŒ© ì˜¤í”ˆ</button>
                <button class="btn" onclick="showScreen('stage-select')">ë“€ì–¼ ì‹œì‘</button>
                <button class="btn" onclick="showCollection()">ì¹´ë“œ ì»¬ë ‰ì…˜</button>
            </div>
            <div class="game-info">
                <div>ì†Œì§€ ì¹´ë“œ: <span id="cardCount">0</span>ì¥</div>
                <div>í´ë¦¬ì–´ ìŠ¤í…Œì´ì§€: <span id="clearedStages">0</span>/10</div>
                <div>ë³´ë„ˆìŠ¤ íŒ©: <span id="bonusPackCount">0</span>ê°œ</div>
            </div>
        </div>

        <!-- ê¸°ë³¸ ì¹´ë“œ ë½‘ê¸° í™”ë©´ -->
        <div class="screen pack-opening" id="pack-opening">
            <h2>ê¸°ë³¸ ì¹´ë“œ íŒ© ì˜¤í”ˆ</h2>
            <div class="pack-container" id="packContainer">
                <!-- íŒ©ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            <button class="btn" onclick="showScreen('dashboard')">ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- ë³´ë„ˆìŠ¤ íŒ© í™”ë©´ -->
        <div class="screen bonus-pack" id="bonus-pack">
            <h2>ğŸ ë³´ë„ˆìŠ¤ íŒ© ì˜¤í”ˆ ğŸ</h2>
            <p style="font-size: 1.2em; margin-bottom: 30px;">ìŠ¹ë¦¬ ë³´ìƒìœ¼ë¡œ ë°›ì€ íŠ¹ë³„í•œ íŒ©ì…ë‹ˆë‹¤!</p>
            <div class="single-pack" id="bonusPack" onclick="openBonusPack()">
                <div>
                    <div style="font-size: 1.5em;">ğŸ†</div>
                    <div>ë³´ë„ˆìŠ¤ íŒ©</div>
                    <div style="font-size: 0.8em;">í´ë¦­í•˜ì—¬ ì˜¤í”ˆ</div>
                </div>
            </div>
            <button class="btn" onclick="showScreen('dashboard')">ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- ìŠ¤í…Œì´ì§€ ì„ íƒ í™”ë©´ -->
        <div class="screen stage-select" id="stage-select">
            <h2>ìŠ¤í…Œì´ì§€ ì„ íƒ</h2>
            <div class="stage-selector" id="stageSelector">
                <!-- ìŠ¤í…Œì´ì§€ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            <button class="btn" onclick="showScreen('dashboard')">ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- ëŒ€ê²° í™”ë©´ -->
        <div class="screen battle" id="battle">
            <div class="battle-info">
                <div>ìƒëŒ€ LP: <span id="opponentLP">8000</span></div>
                <div>ìŠ¤í…Œì´ì§€: <span id="currentStage">1</span></div>
                <div>ë‚´ LP: <span id="playerLP">8000</span></div>
            </div>

            <div class="phase-indicator" id="phaseIndicator">ë‚´ í„´</div>

            <!-- ìœ í¬ì™• ë“€ì–¼ í…Œì´ë¸” -->
            <div class="duel-table">
                <!-- ìƒëŒ€ ì˜ì—­ -->
                <div class="field-side">
                    <div class="field-label">ìƒëŒ€ í•„ë“œ</div>
                    
                    <!-- ìƒëŒ€ ë§ˆë²•/í•¨ì • ì¡´ -->
                    <div class="field-zones" id="opponentSpellTrapZones">
                        <!-- ìƒëŒ€ ë§ˆë²•/í•¨ì • ì¡´ë“¤ -->
                    </div>
                    
                    <!-- ìƒëŒ€ ëª¬ìŠ¤í„° ì¡´ -->
                    <div class="field-zones" id="opponentMonsterZones">
                        <!-- ìƒëŒ€ ëª¬ìŠ¤í„° ì¡´ë“¤ -->
                    </div>
                </div>

                <!-- ë°°í‹€ ë¡œê·¸ -->
                <div class="battle-log" id="battleLog">
                    ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                </div>

                <!-- í”Œë ˆì´ì–´ ì˜ì—­ -->
                <div class="field-side">
                    <div class="field-label">ë‚´ í•„ë“œ</div>
                    
                    <!-- í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° ì¡´ -->
                    <div class="field-zones" id="playerMonsterZones">
                        <!-- í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° ì¡´ë“¤ -->
                    </div>
                    
                    <!-- í”Œë ˆì´ì–´ ë§ˆë²•/í•¨ì • ì¡´ -->
                    <div class="field-zones" id="playerSpellTrapZones">
                        <!-- í”Œë ˆì´ì–´ ë§ˆë²•/í•¨ì • ì¡´ë“¤ -->
                    </div>
                </div>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ -->
            <div class="controls">
                <button class="btn" onclick="endTurn()" id="endTurnBtn">ë‚´ í„´ ì¢…ë£Œ</button>
                <button class="btn" onclick="directAttack()" id="directAttackBtn" style="display:none;">ì§ì ‘ ê³µê²©</button>
                <button class="btn" onclick="showScreen('dashboard')">ê²Œì„ ì¢…ë£Œ</button>
            </div>

            <!-- í”Œë ˆì´ì–´ íŒ¨ -->
            <div class="hand" id="playerHand">
                <!-- í”Œë ˆì´ì–´ì˜ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì¹´ë“œ ê³µê°œ ì˜¤ë²„ë ˆì´ -->
        <div class="card-reveal-overlay" id="cardRevealOverlay">
            <button class="close-btn" onclick="closeCardReveal()">ë‹«ê¸°</button>
            <div class="card-reveal-container" id="cardRevealContainer">
                <!-- ë½‘ì€ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ -->
        <div class="card-select-modal" id="cardSelectModal">
            <div class="card-select-container">
                <h3>ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
                <button class="close-btn" onclick="closeCardSelect()">ë‹«ê¸°</button>
                <div class="card-grid" id="cardSelectGrid">
                    <!-- ì„ íƒ ê°€ëŠ¥í•œ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ ê´€ë¦¬
        let gameState = {
            playerLP: 8000,
            opponentLP: 8000,
            playerHand: [],
            playerDeck: [],
            playerMonsterField: [null, null, null, null, null],
            playerSpellTrapField: [null, null, null, null, null],
            opponentHand: [],
            opponentDeck: [],
            opponentMonsterField: [null, null, null, null, null],
            opponentSpellTrapField: [null, null, null, null, null],
            currentPhase: 'main',
            turn: 'player',
            currentStage: 1,
            clearedStages: 0,
            collection: [],
            packsOpened: 0,
            bonusPackCount: 0,
            selectedCard: null,
            selectedZone: null,
            canSummon: true
        };

        // ì¹´ë“œ ë°ì´í„°ë² ì´ìŠ¤
        const cardDatabase = [
            {id: 1, name: 'í‘¸ë¥¸ ëˆˆì˜ ë°±ë£¡', type: 'monster', attack: 3000, defense: 2500, level: 8, illustration: 'ğŸ‰', description: 'ì „ì„¤ì˜ ë°±ë£¡. ì••ë„ì ì¸ íŒŒê´´ë ¥ì„ ìë‘í•œë‹¤.'},
            {id: 2, name: 'ë¸”ë™ ë§¤ì§€ì…˜', type: 'monster', attack: 2500, defense: 2100, level: 7, illustration: 'ğŸ§™â€â™‚ï¸', description: 'ì–´ë‘ ì˜ ë§ˆë²•ì„ ë‹¤ë£¨ëŠ” ë§ˆë²•ì‚¬.'},
            {id: 3, name: 'ì—˜í”„ì˜ ê²€ì‚¬', type: 'monster', attack: 1400, defense: 1200, level: 4, illustration: 'ğŸ§â€â™€ï¸', description: 'ìˆ²ì„ ì§€í‚¤ëŠ” ì—˜í”„ ì „ì‚¬.'},
            {id: 4, name: 'ì•”í‘ê¸°ì‚¬ ê°€ì´ì•„', type: 'monster', attack: 2300, defense: 2100, level: 7, illustration: 'âš”ï¸', description: 'ì–´ë‘ ì˜ í˜ì„ ê°€ì§„ ê¸°ì‚¬.'},
            {id: 5, name: 'ì €ì£¼ë°›ì€ ìš©', type: 'monster', attack: 2000, defense: 1500, level: 5, illustration: 'ğŸ²', description: 'ì €ì£¼ì— ê±¸ë¦° ì‚¬ì•…í•œ ìš©.'},
            {id: 6, name: 'ê³ ë¸”ë¦° ì–´íƒ í¬ìŠ¤', type: 'monster', attack: 2300, defense: 0, level: 4, illustration: 'ğŸ‘¹', description: 'ê³µê²©ì— íŠ¹í™”ëœ ê³ ë¸”ë¦° ë¶€ëŒ€.'},
            {id: 7, name: 'ì ¬ë‚˜ì´íŠ¸ ê°€ë„·', type: 'monster', attack: 1900, defense: 0, level: 4, illustration: 'ğŸ’', description: 'ë³´ì„ì˜ í˜ì„ ê°€ì§„ ì „ì‚¬.'},
            {id: 8, name: 'ë²ˆê°œ', type: 'magic', effect: 'ëª¬ìŠ¤í„° 1ì²´ë¥¼ íŒŒê´´í•œë‹¤', illustration: 'âš¡', description: 'ê°•ë ¥í•œ ë²ˆê°œë¡œ ì ì„ íŒŒê´´í•œë‹¤.'},
            {id: 9, name: 'ì–´ë‘ ì˜ êµ¬ë©', type: 'magic', effect: 'ìƒëŒ€ í•„ë“œì˜ ëª¬ìŠ¤í„°ë¥¼ ëª¨ë‘ íŒŒê´´í•œë‹¤', illustration: 'ğŸ•³ï¸', description: 'ëª¨ë“  ê²ƒì„ ì‚¼í‚¤ëŠ” ì–´ë‘ ì˜ êµ¬ë©.'},
            {id: 10, name: 'ê°•í™”', type: 'magic', effect: 'ëª¬ìŠ¤í„°ì˜ ê³µê²©ë ¥ì„ 1000 ì˜¬ë¦°ë‹¤', illustration: 'ğŸ’ª', description: 'ëª¬ìŠ¤í„°ì˜ í˜ì„ ê°•í™”ì‹œí‚¨ë‹¤.'},
            {id: 11, name: 'ë¯¸ëŸ¬ í¬ìŠ¤', type: 'trap', effect: 'ìƒëŒ€ì˜ ê³µê²©ì„ ë¬´íš¨í™”í•˜ê³  ê³µê²© ëª¬ìŠ¤í„°ë¥¼ íŒŒê´´í•œë‹¤', illustration: 'ğŸ›¡ï¸', description: 'ê³µê²©ì„ ë°˜ì‚¬í•˜ëŠ” í•¨ì •.'},
            {id: 12, name: 'í•¨ì • êµ¬ë©', type: 'trap', effect: 'ê³µê²©ë ¥ 1000 ì´ìƒì˜ ëª¬ìŠ¤í„°ë¥¼ íŒŒê´´í•œë‹¤', illustration: 'ğŸ•³ï¸', description: 'ê°•ë ¥í•œ ëª¬ìŠ¤í„°ë¥¼ í•¨ì •ì— ë¹ ëœ¨ë¦°ë‹¤.'}
        ];

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        function showScreen(screenId) {
            // ëª¨ë“  í™”ë©´ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // ì„ íƒëœ í™”ë©´ ë³´ì´ê¸°
            document.getElementById(screenId).classList.add('active');
            
            // í™”ë©´ë³„ ì´ˆê¸°í™”
            if (screenId === 'pack-opening') {
                initPackOpening();
            } else if (screenId === 'stage-select') {
                initStageSelect();
            } else if (screenId === 'bonus-pack') {
                updateBonusPackDisplay();
            } else if (screenId === 'dashboard') {
                updateUI();
            }
        }

        // ê¸°ë³¸ ì¹´ë“œ íŒ© ì˜¤í”ˆ ì´ˆê¸°í™”
        function initPackOpening() {
            const container = document.getElementById('packContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < 10; i++) {
                const pack = document.createElement('div');
                pack.className = gameState.packsOpened > i ? 'pack opened' : 'pack';
                pack.textContent = gameState.packsOpened > i ? 'ì˜¤í”ˆë¨' : `íŒ© ${i + 1}`;
                if (gameState.packsOpened <= i) {
                    pack.onclick = () => openPack(i, pack);
                }
                container.appendChild(pack);
            }
        }

        // ë³´ë„ˆìŠ¤ íŒ© í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateBonusPackDisplay() {
            const bonusPack = document.getElementById('bonusPack');
            const bonusBtn = document.getElementById('bonusPackBtn');
            
            if (gameState.bonusPackCount > 0) {
                bonusBtn.style.display = 'block';
                bonusPack.style.display = 'flex';
            } else {
                bonusBtn.style.display = 'none';
                bonusPack.innerHTML = '<div><div style="font-size: 1.5em;">âŒ</div><div>ë³´ë„ˆìŠ¤ íŒ© ì—†ìŒ</div></div>';
            }
        }

        // ê¸°ë³¸ íŒ© ì˜¤í”ˆ í•¨ìˆ˜
        function openPack(packIndex, packElement) {
            if (packElement.classList.contains('opened')) return;
            
            packElement.classList.add('opened');
            packElement.textContent = 'ì˜¤í”ˆë¨';
            gameState.packsOpened++;
            
            // ëœë¤ ì¹´ë“œ 5ì¥ ì§€ê¸‰
            const newCards = [];
            for (let i = 0; i < 5; i++) {
                const randomCard = cardDatabase[Math.floor(Math.random() * cardDatabase.length)];
                const cardCopy = {...randomCard, uniqueId: Date.now() + Math.random()};
                gameState.collection.push(cardCopy);
                newCards.push(cardCopy);
            }
            
            updateUI();
            showCardReveal(newCards);
        }

        // ë³´ë„ˆìŠ¤ íŒ© ì˜¤í”ˆ í•¨ìˆ˜
        function openBonusPack() {
            if (gameState.bonusPackCount <= 0) {
                alert('ë³´ë„ˆìŠ¤ íŒ©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            gameState.bonusPackCount--;
            
            // ë³´ë„ˆìŠ¤ íŒ©ì€ ë” ì¢‹ì€ ì¹´ë“œë“¤ë¡œ êµ¬ì„±
            const newCards = [];
            for (let i = 0; i < 7; i++) {
                const randomCard = cardDatabase[Math.floor(Math.random() * cardDatabase.length)];
                const cardCopy = {...randomCard, uniqueId: Date.now() + Math.random()};
                // ë³´ë„ˆìŠ¤ íŒ©ì—ì„œëŠ” ìŠ¤íƒ¯ì´ í–¥ìƒ
                if (cardCopy.attack) {
                    cardCopy.attack += Math.floor(Math.random() * 300) + 100;
                }
                if (cardCopy.defense) {
                    cardCopy.defense += Math.floor(Math.random() * 200) + 50;
                }
                gameState.collection.push(cardCopy);
                newCards.push(cardCopy);
            }
            
            updateUI();
            showCardReveal(newCards);
            updateBonusPackDisplay();
        }

        // ì¹´ë“œ ê³µê°œ ì• ë‹ˆë©”ì´ì…˜
        function showCardReveal(cards) {
            const overlay = document.getElementById('cardRevealOverlay');
            const container = document.getElementById('cardRevealContainer');
            
            container.innerHTML = '';
            
            cards.forEach((card, index) => {
                const cardReveal = document.createElement('div');
                cardReveal.className = 'card-reveal';
                cardReveal.innerHTML = `
                    <div class="card-inner">
                        <div class="card-back">
                            <div>ìœ í¬ì™•</div>
                            <div>ì¹´ë“œ</div>
                        </div>
                        <div class="card-front ${card.type}">
                            <div class="card-illustration">${card.illustration}</div>
                            <div style="font-weight: bold; font-size: 0.9em; margin-bottom: 5px;">${card.name}</div>
                            ${card.attack ? `<div style="font-size: 0.8em;">ATK: ${card.attack}</div>` : ''}
                            ${card.defense ? `<div style="font-size: 0.8em;">DEF: ${card.defense}</div>` : ''}
                            <div style="font-size: 0.7em; margin-top: 5px; text-align: center;">${card.description}</div>
                        </div>
                    </div>
                `;
                
                cardReveal.onclick = () => {
                    cardReveal.classList.add('flipped');
                };
                
                container.appendChild(cardReveal);
                
                // ìë™ìœ¼ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ë’¤ì§‘ê¸°
                setTimeout(() => {
                    cardReveal.classList.add('flipped');
                }, index * 500);
            });
            
            overlay.style.display = 'flex';
        }

        // ì¹´ë“œ ê³µê°œ ë‹«ê¸°
        function closeCardReveal() {
            document.getElementById('cardRevealOverlay').style.display = 'none';
        }

        // ìŠ¤í…Œì´ì§€ ì„ íƒ ì´ˆê¸°í™”
        function initStageSelect() {
            const container = document.getElementById('stageSelector');
            container.innerHTML = '';
            
            for (let i = 1; i <= 10; i++) {
                const btn = document.createElement('button');
                btn.className = 'stage-btn';
                btn.textContent = `ìŠ¤í…Œì´ì§€ ${i}`;
                btn.disabled = i > gameState.clearedStages + 1 || gameState.collection.length < 10;
                if (gameState.collection.length < 10) {
                    btn.title = 'ìµœì†Œ 10ì¥ì˜ ì¹´ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤';
                }
                btn.onclick = () => startBattle(i);
                container.appendChild(btn);
            }
        }

        // ë°°í‹€ ì‹œì‘
        function startBattle(stage) {
            if (gameState.collection.length < 10) {
                alert('ì¹´ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ìµœì†Œ 10ì¥ì˜ ì¹´ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            gameState.currentStage = stage;
            gameState.playerLP = 8000;
            gameState.opponentLP = 8000 + (stage - 1) * 1000;
            gameState.turn = 'player';
            gameState.canSummon = true;
            gameState.selectedCard = null;
            gameState.selectedZone = null;
            
            // í•„ë“œ ì´ˆê¸°í™”
            gameState.playerMonsterField = [null, null, null, null, null];
            gameState.playerSpellTrapField = [null, null, null, null, null];
            gameState.opponentMonsterField = [null, null, null, null, null];
            gameState.opponentSpellTrapField = [null, null, null, null, null];
            
            // ë± êµ¬ì„±
            gameState.playerDeck = [...gameState.collection].slice(0, 20);
            gameState.opponentDeck = [];
            
            // ìƒëŒ€ ë± êµ¬ì„±
            for (let i = 0; i < 20; i++) {
                const baseCard = cardDatabase[Math.floor(Math.random() * cardDatabase.length)];
                const enhancedCard = {...baseCard, uniqueId: Date.now() + Math.random()};
                if (enhancedCard.attack) {
                    enhancedCard.attack += (stage - 1) * 200;
                }
                gameState.opponentDeck.push(enhancedCard);
            }
            
            gameState.playerHand = [];
            gameState.opponentHand = [];
            
            // ì´ˆê¸° íŒ¨ ë“œë¡œìš°
            for (let i = 0; i < 5; i++) {
                drawCard('player');
                drawCard('opponent');
            }
            
            showScreen('battle');
            initBattleField();
            updateBattleUI();
            addBattleLog(`ìŠ¤í…Œì´ì§€ ${stage} ì‹œì‘! ìƒëŒ€ LP: ${gameState.opponentLP}`);
        }

        // ë°°í‹€ í•„ë“œ ì´ˆê¸°í™”
        function initBattleField() {
            // í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° ì¡´ ìƒì„±
            const playerMonsterZones = document.getElementById('playerMonsterZones');
            playerMonsterZones.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const zone = document.createElement('div');
                zone.className = 'zone monster-zone';
                zone.textContent = 'ëª¬ìŠ¤í„° ì¡´';
                zone.onclick = () => selectZone('player', 'monster', i);
                playerMonsterZones.appendChild(zone);
            }

            // í”Œë ˆì´ì–´ ë§ˆë²•/í•¨ì • ì¡´ ìƒì„±
            const playerSpellTrapZones = document.getElementById('playerSpellTrapZones');
            playerSpellTrapZones.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const zone = document.createElement('div');
                zone.className = 'zone spell-trap-zone';
                zone.textContent = 'ë§ˆë²•/í•¨ì •';
                zone.onclick = () => selectZone('player', 'spell', i);
                playerSpellTrapZones.appendChild(zone);
            }

            // ìƒëŒ€ ëª¬ìŠ¤í„° ì¡´ ìƒì„±
            const opponentMonsterZones = document.getElementById('opponentMonsterZones');
            opponentMonsterZones.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const zone = document.createElement('div');
                zone.className = 'zone monster-zone';
                zone.textContent = 'ëª¬ìŠ¤í„° ì¡´';
                zone.onclick = () => attackMonster(i);
                opponentMonsterZones.appendChild(zone);
            }

            // ìƒëŒ€ ë§ˆë²•/í•¨ì • ì¡´ ìƒì„±
            const opponentSpellTrapZones = document.getElementById('opponentSpellTrapZones');
            opponentSpellTrapZones.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const zone = document.createElement('div');
                zone.className = 'zone spell-trap-zone';
                zone.textContent = 'ë§ˆë²•/í•¨ì •';
                opponentSpellTrapZones.appendChild(zone);
            }
        }

        // ì¡´ ì„ íƒ í•¨ìˆ˜
        function selectZone(player, zoneType, index) {
            if (gameState.turn !== 'player') {
                alert('ë‹¹ì‹ ì˜ í„´ì´ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }
            
            // ì´ë¯¸ ì¹´ë“œê°€ ìˆëŠ” ì¡´ì¸ì§€ í™•ì¸
            const field = zoneType === 'monster' ? gameState.playerMonsterField : gameState.playerSpellTrapField;
            if (field[index]) {
                // ì´ë¯¸ ìˆëŠ” ì¹´ë“œ ì„ íƒ (ê³µê²©ìš©)
                if (zoneType === 'monster') {
                    gameState.selectedCard = field[index];
                    updateBattleUI();
                    addBattleLog(`${gameState.selectedCard.name}ì„(ë¥¼) ì„ íƒí–ˆìŠµë‹ˆë‹¤. ê³µê²©í•  ëŒ€ìƒì„ ì„ íƒí•˜ì„¸ìš”.`);
                }
                return;
            }
            
            gameState.selectedZone = { player, zoneType, index };
            
            // ì¡´ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.zone').forEach(zone => zone.classList.remove('selected'));
            const zoneElement = document.querySelector(`#player${zoneType === 'monster' ? 'Monster' : 'SpellTrap'}Zones .zone:nth-child(${index + 1})`);
            if (zoneElement) {
                zoneElement.classList.add('selected');
            }
            
            // ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
            showCardSelectModal(zoneType);
        }

        // ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        function showCardSelectModal(zoneType) {
            const modal = document.getElementById('cardSelectModal');
            const grid = document.getElementById('cardSelectGrid');
            
            grid.innerHTML = '';
            
            // í•´ë‹¹ ì¡´ì— ë†“ì„ ìˆ˜ ìˆëŠ” ì¹´ë“œë“¤ë§Œ í•„í„°ë§
            const availableCards = gameState.playerHand.filter(card => {
                if (zoneType === 'monster') {
                    return card.type === 'monster';
                } else {
                    return card.type === 'magic' || card.type === 'trap';
                }
            });
            
            if (availableCards.length === 0) {
                grid.innerHTML = '<p>ë†“ì„ ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                availableCards.forEach((card) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = `card ${card.type}`;
                    cardElement.innerHTML = `
                        <div style="font-weight: bold; font-size: 0.7em;">${card.name}</div>
                        <div style="font-size: 1.2em;">${card.illustration}</div>
                        ${card.attack ? `<div>ATK: ${card.attack}</div>` : ''}
                        ${card.defense ? `<div>DEF: ${card.defense}</div>` : ''}
                    `;
                    cardElement.onclick = () => placeCardInZone(card);
                    grid.appendChild(cardElement);
                });
            }
            
            modal.style.display = 'flex';
        }

        // ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
        function closeCardSelect() {
            document.getElementById('cardSelectModal').style.display = 'none';
            document.querySelectorAll('.zone').forEach(zone => zone.classList.remove('selected'));
            gameState.selectedZone = null;
        }

        // ì¹´ë“œë¥¼ ì¡´ì— ë°°ì¹˜
        function placeCardInZone(card) {
            if (!gameState.selectedZone) return;
            
            const { zoneType, index } = gameState.selectedZone;
            const handIndex = gameState.playerHand.findIndex(c => c.uniqueId === card.uniqueId);
            
            if (zoneType === 'monster') {
                if (card.type !== 'monster') {
                    alert('ëª¬ìŠ¤í„° ì¡´ì—ëŠ” ëª¬ìŠ¤í„° ì¹´ë“œë§Œ ë†“ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                if (!gameState.canSummon) {
                    alert('ì´ë²ˆ í„´ì—ëŠ” ì´ë¯¸ ì†Œí™˜í–ˆìŠµë‹ˆë‹¤.');
                    return;
                }
                gameState.playerMonsterField[index] = card;
                gameState.canSummon = false;
                addBattleLog(`${card.name}ì„(ë¥¼) ì†Œí™˜í–ˆìŠµë‹ˆë‹¤! (ATK: ${card.attack})`);
            } else {
                if (card.type === 'monster') {
                    alert('ë§ˆë²•/í•¨ì • ì¡´ì—ëŠ” ë§ˆë²•ì´ë‚˜ í•¨ì • ì¹´ë“œë§Œ ë†“ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                gameState.playerSpellTrapField[index] = card;
                addBattleLog(`${card.name}ì„(ë¥¼) ì„¸íŠ¸í–ˆìŠµë‹ˆë‹¤.`);
                
                // ë§ˆë²• ì¹´ë“œëŠ” ì¦‰ì‹œ ë°œë™
                if (card.type === 'magic') {
                    activateMagicCard(card, index);
                }
            }
            
            // ì†íŒ¨ì—ì„œ ì¹´ë“œ ì œê±°
            gameState.playerHand.splice(handIndex, 1);
            
            closeCardSelect();
            updateBattleUI();
        }

        // ë§ˆë²• ì¹´ë“œ ë°œë™
        function activateMagicCard(card, index) {
            if (card.name === 'ë²ˆê°œ' && gameState.opponentMonsterField.some(c => c)) {
                const targetIndex = gameState.opponentMonsterField.findIndex(c => c);
                const target = gameState.opponentMonsterField[targetIndex];
                gameState.opponentMonsterField[targetIndex] = null;
                addBattleLog(`${card.name} ë°œë™! ${target.name}ì„(ë¥¼) íŒŒê´´í–ˆìŠµë‹ˆë‹¤!`);
            } else if (card.name === 'ì–´ë‘ ì˜ êµ¬ë©') {
                gameState.opponentMonsterField = [null, null, null, null, null];
                addBattleLog(`${card.name} ë°œë™! ìƒëŒ€ í•„ë“œì˜ ëª¨ë“  ëª¬ìŠ¤í„°ë¥¼ íŒŒê´´í–ˆìŠµë‹ˆë‹¤!`);
            } else if (card.name === 'ê°•í™”') {
                const playerMonsters = gameState.playerMonsterField.filter(c => c);
                if (playerMonsters.length > 0) {
                    playerMonsters[0].attack += 1000;
                    addBattleLog(`${card.name} ë°œë™! ${playerMonsters[0].name}ì˜ ê³µê²©ë ¥ì´ 1000 ì¦ê°€í–ˆìŠµë‹ˆë‹¤!`);
                }
            }
            
            // ë§ˆë²• ì¹´ë“œëŠ” ë°œë™ í›„ ì œê±°
            gameState.playerSpellTrapField[index] = null;
        }

        // ì¹´ë“œ ë“œë¡œìš°
        function drawCard(player) {
            if (player === 'player' && gameState.playerDeck.length > 0) {
                const card = gameState.playerDeck.pop();
                gameState.playerHand.push(card);
            } else if (player === 'opponent' && gameState.opponentDeck.length > 0) {
                const card = gameState.opponentDeck.pop();
                gameState.opponentHand.push(card);
            }
        }

        // í„´ ì¢…ë£Œ
        function endTurn() {
            gameState.turn = gameState.turn === 'player' ? 'opponent' : 'player';
            gameState.selectedCard = null;
            gameState.selectedZone = null;
            
            if (gameState.turn === 'player') {
                drawCard('player');
                gameState.canSummon = true;
                addBattleLog('ë‚´ í„´ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                drawCard('opponent');
                addBattleLog('ìƒëŒ€ í„´ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
                // AI í„´ ì‹œë®¬ë ˆì´ì…˜
                setTimeout(() => {
                    aiTurn();
                }, 1500);
            }
            
            updateBattleUI();
        }

        // AI í„´ ì‹œë®¬ë ˆì´ì…˜
        function aiTurn() {
            // AI ëª¬ìŠ¤í„° ì†Œí™˜
            const monstersInHand = gameState.opponentHand.filter(card => card.type === 'monster');
            if (monstersInHand.length > 0) {
                const emptySlot = gameState.opponentMonsterField.findIndex(slot => !slot);
                if (emptySlot !== -1) {
                    const cardToSummon = monstersInHand[0];
                    gameState.opponentHand = gameState.opponentHand.filter(card => card.uniqueId !== cardToSummon.uniqueId);
                    gameState.opponentMonsterField[emptySlot] = cardToSummon;
                    addBattleLog(`ìƒëŒ€ê°€ ${cardToSummon.name}ì„(ë¥¼) ì†Œí™˜í–ˆìŠµë‹ˆë‹¤!`);
                }
            }
            
            // AI ê³µê²©
            setTimeout(() => {
                gameState.opponentMonsterField.forEach((monster) => {
                    if (!monster) return;
                    
                    const playerMonsters = gameState.playerMonsterField.filter(c => c);
                    if (playerMonsters.length > 0) {
                        // í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° ê³µê²©
                        const target = playerMonsters[0];
                        const targetIndex = gameState.playerMonsterField.findIndex(c => c && c.uniqueId === target.uniqueId);
                        performBattle(monster, target, false, targetIndex);
                    } else {
                        // ì§ì ‘ ê³µê²©
                        gameState.playerLP -= monster.attack;
                        addBattleLog(`${monster.name}ì˜ ì§ì ‘ ê³µê²©! ${monster.attack} ë°ë¯¸ì§€!`);
                    }
                });
                
                checkGameEnd();
                
                // AI í„´ ì¢…ë£Œ
                setTimeout(() => {
                    endTurn();
                }, 1000);
            }, 1000);
        }

        // ëª¬ìŠ¤í„° ê³µê²©
        function attackMonster(targetIndex) {
            if (!gameState.selectedCard || !gameState.opponentMonsterField[targetIndex]) {
                return;
            }
            
            const attacker = gameState.selectedCard;
            const target = gameState.opponentMonsterField[targetIndex];
            
            performBattle(attacker, target, true, targetIndex);
        }

        // ì „íˆ¬ ìˆ˜í–‰
        function performBattle(attacker, target, isPlayerAttacking, targetIndex) {
            setTimeout(() => {
                if (attacker.attack > target.attack) {
                    // ê³µê²© ì„±ê³µ
                    const damage = attacker.attack - target.attack;
                    if (isPlayerAttacking) {
                        gameState.opponentLP -= damage;
                        gameState.opponentMonsterField[targetIndex] = null;
                    } else {
                        gameState.playerLP -= damage;
                        gameState.playerMonsterField[targetIndex] = null;
                    }
                    addBattleLog(`${attacker.name}ì´(ê°€) ${target.name}ì„(ë¥¼) íŒŒê´´! ${damage} ë°ë¯¸ì§€!`);
                    
                } else if (attacker.attack === target.attack) {
                    // ìƒì‡„
                    if (isPlayerAttacking) {
                        gameState.opponentMonsterField[targetIndex] = null;
                        const attackerIndex = gameState.playerMonsterField.findIndex(card => card && card.uniqueId === attacker.uniqueId);
                        gameState.playerMonsterField[attackerIndex] = null;
                    } else {
                        gameState.playerMonsterField[targetIndex] = null;
                        const attackerIndex = gameState.opponentMonsterField.findIndex(card => card && card.uniqueId === attacker.uniqueId);
                        gameState.opponentMonsterField[attackerIndex] = null;
                    }
                    addBattleLog(`${attacker.name}ê³¼(ì™€) ${target.name}ì´(ê°€) ìƒì‡„ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    
                } else {
                    // ê³µê²© ì‹¤íŒ¨
                    const damage = target.attack - attacker.attack;
                    if (isPlayerAttacking) {
                        gameState.playerLP -= damage;
                        const attackerIndex = gameState.playerMonsterField.findIndex(card => card && card.uniqueId === attacker.uniqueId);
                        gameState.playerMonsterField[attackerIndex] = null;
                    } else {
                        gameState.opponentLP -= damage;
                        const attackerIndex = gameState.opponentMonsterField.findIndex(card => card && card.uniqueId === attacker.uniqueId);
                        gameState.opponentMonsterField[attackerIndex] = null;
                    }
                    addBattleLog(`${attacker.name}ì´(ê°€) íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤! ${damage} ë°ë¯¸ì§€ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤!`);
                }
                
                gameState.selectedCard = null;
                checkGameEnd();
                updateBattleUI();
            }, 500);
        }

        // ì§ì ‘ ê³µê²©
        function directAttack() {
            if (!gameState.selectedCard || gameState.opponentMonsterField.some(c => c)) return;
            
            const attacker = gameState.selectedCard;
            gameState.opponentLP -= attacker.attack;
            addBattleLog(`${attacker.name}ì˜ ì§ì ‘ ê³µê²©! ${attacker.attack} ë°ë¯¸ì§€!`);
            
            gameState.selectedCard = null;
            checkGameEnd();
            updateBattleUI();
        }

        // ê²Œì„ ì¢…ë£Œ ì²´í¬
        function checkGameEnd() {
            if (gameState.playerLP <= 0) {
                alert('íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤!');
                showScreen('dashboard');
                return true;
            }
            
            if (gameState.opponentLP <= 0) {
                alert('ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!');
                if (gameState.currentStage > gameState.clearedStages) {
                    gameState.clearedStages = gameState.currentStage;
                    // ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤ íŒ© ì§€ê¸‰
                    gameState.bonusPackCount++;
                    addBattleLog('ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤ íŒ©ì„ íšë“í–ˆìŠµë‹ˆë‹¤!');
                }
                showScreen('dashboard');
                return true;
            }
            
            return false;
        }

        // ë°°í‹€ ë¡œê·¸ ì¶”ê°€
        function addBattleLog(message) {
            const log = document.getElementById('battleLog');
            if (log) {
                log.innerHTML += message + '<br>';
                log.scrollTop = log.scrollHeight;
            }
        }

        // ë°°í‹€ UI ì—…ë°ì´íŠ¸
        function updateBattleUI() {
            document.getElementById('playerLP').textContent = gameState.playerLP;
            document.getElementById('opponentLP').textContent = gameState.opponentLP;
            document.getElementById('currentStage').textContent = gameState.currentStage;
            document.getElementById('phaseIndicator').textContent = gameState.turn === 'player' ? 'ë‚´ í„´' : 'ìƒëŒ€ í„´';
            
            // í”Œë ˆì´ì–´ íŒ¨ í‘œì‹œ
            const handContainer = document.getElementById('playerHand');
            handContainer.innerHTML = '';
            
            gameState.playerHand.forEach((card) => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${card.type}`;
                cardElement.innerHTML = `
                    <div style="font-weight: bold; font-size: 0.7em;">${card.name}</div>
                    <div style="font-size: 1.2em;">${card.illustration}</div>
                    ${card.attack ? `<div>ATK: ${card.attack}</div>` : ''}
                    ${card.defense ? `<div>DEF: ${card.defense}</div>` : ''}
                `;
                handContainer.appendChild(cardElement);
            });
            
            // í•„ë“œ ì—…ë°ì´íŠ¸
            updateFieldDisplay();
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('endTurnBtn').disabled = gameState.turn !== 'player';
            
            // ì§ì ‘ ê³µê²© ë²„íŠ¼
            const directAttackBtn = document.getElementById('directAttackBtn');
            if (gameState.selectedCard && !gameState.opponentMonsterField.some(c => c)) {
                directAttackBtn.style.display = 'inline-block';
            } else {
                directAttackBtn.style.display = 'none';
            }
        }

        // í•„ë“œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateFieldDisplay() {
            // í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° ì¡´
            const playerMonsterZones = document.getElementById('playerMonsterZones');
            playerMonsterZones.querySelectorAll('.zone').forEach((zone, index) => {
                const card = gameState.playerMonsterField[index];
                if (card) {
                    zone.innerHTML = `
                        <div class="card monster ${gameState.selectedCard && gameState.selectedCard.uniqueId === card.uniqueId ? 'selected' : ''}">
                            <div style="font-weight: bold; font-size: 0.7em;">${card.name}</div>
                            <div style="font-size: 1em;">${card.illustration}</div>
                            <div>ATK: ${card.attack}</div>
                        </div>
                    `;
                    zone.classList.add('occupied');
                } else {
                    zone.innerHTML = 'ëª¬ìŠ¤í„° ì¡´';
                    zone.classList.remove('occupied');
                }
            });
            
            // í”Œë ˆì´ì–´ ë§ˆë²•/í•¨ì • ì¡´
            const playerSpellTrapZones = document.getElementById('playerSpellTrapZones');
            playerSpellTrapZones.querySelectorAll('.zone').forEach((zone, index) => {
                const card = gameState.playerSpellTrapField[index];
                if (card) {
                    zone.innerHTML = `
                        <div class="card ${card.type}">
                            <div style="font-weight: bold; font-size: 0.7em;">${card.name}</div>
                            <div style="font-size: 1em;">${card.illustration}</div>
                        </div>
                    `;
                    zone.classList.add('occupied');
                } else {
                    zone.innerHTML = 'ë§ˆë²•/í•¨ì •';
                    zone.classList.remove('occupied');
                }
            });
            
            // ìƒëŒ€ ëª¬ìŠ¤í„° ì¡´
            const opponentMonsterZones = document.getElementById('opponentMonsterZones');
            opponentMonsterZones.querySelectorAll('.zone').forEach((zone, index) => {
                const card = gameState.opponentMonsterField[index];
                if (card) {
                    zone.innerHTML = `
                        <div class="card monster">
                            <div style="font-weight: bold; font-size: 0.7em;">${card.name}</div>
                            <div style="font-size: 1em;">${card.illustration}</div>
                            <div>ATK: ${card.attack}</div>
                        </div>
                    `;
                    zone.classList.add('occupied');
                } else {
                    zone.innerHTML = 'ëª¬ìŠ¤í„° ì¡´';
                    zone.classList.remove('occupied');
                }
            });
            
            // ìƒëŒ€ ë§ˆë²•/í•¨ì • ì¡´
            const opponentSpellTrapZones = document.getElementById('opponentSpellTrapZones');
            opponentSpellTrapZones.querySelectorAll('.zone').forEach((zone, index) => {
                const card = gameState.opponentSpellTrapField[index];
                if (card) {
                    zone.innerHTML = `
                        <div class="card ${card.type}">
                            <div style="font-weight: bold; font-size: 0.7em;">${card.name}</div>
                            <div style="font-size: 1em;">${card.illustration}</div>
                        </div>
                    `;
                    zone.classList.add('occupied');
                } else {
                    zone.innerHTML = 'ë§ˆë²•/í•¨ì •';
                    zone.classList.remove('occupied');
                }
            });
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            document.getElementById('cardCount').textContent = gameState.collection.length;
            document.getElementById('clearedStages').textContent = gameState.clearedStages;
            document.getElementById('bonusPackCount').textContent = gameState.bonusPackCount;
            updateBonusPackDisplay();
        }

        // ì»¬ë ‰ì…˜ ë³´ê¸°
        function showCollection() {
            if (gameState.collection.length === 0) {
                alert('ë³´ìœ í•œ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤. ì¹´ë“œ íŒ©ì„ ë¨¼ì € ì—´ì–´ë³´ì„¸ìš”!');
                return;
            }
            
            let collectionText = 'ë³´ìœ  ì¹´ë“œ ëª©ë¡:\n\n';
            gameState.collection.forEach((card, index) => {
                collectionText += `${index + 1}. ${card.illustration} ${card.name} (${card.type})`;
                if (card.attack) collectionText += ` - ATK: ${card.attack}`;
                collectionText += '\n';
            });
            
            alert(collectionText);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” - ëŒ€ì‹œë³´ë“œê°€ ê¸°ë³¸ í™”ë©´ìœ¼ë¡œ ì„¤ì •ë¨
        document.addEventListener('DOMContentLoaded', function() {
            updateUI();
        });
    </script>
</body>
</html>
